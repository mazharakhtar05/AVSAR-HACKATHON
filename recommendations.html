<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recommendations - AVSAR Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="/static/translations.js"></script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f7f9fc;
        }
        .tricolor-bar { 
            height: 5px; 
            width: 100%; 
            background: linear-gradient(to right, #FF9933 33.3%, #FFFFFF 33.3%, #FFFFFF 66.6%, #138808 66.6%); 
        }
        .card {
            background-color: white;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover { transform: translateY(-6px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.09); }
        .profile-dropdown-menu { display: none; }
        .profile-dropdown-menu.active { display: block; }
        .filter-btn.active { background-color: #1d4ed8; color: white; border-color: #1d4ed8; box-shadow: 0 4px 14px rgba(29, 78, 216, 0.2); }
        .avsar-banner { background: linear-gradient(135deg, #001f3f 0%, #003366 100%); position: relative; overflow: hidden; }
        .avsar-banner::before { content: ''; position: absolute; top: 50%; left: 50%; width: 800px; height: 800px; background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/1/17/Ashoka_Chakra.svg/1200px-Ashoka_Chakra.svg.png') no-repeat center center; background-size: contain; opacity: 0.05; transform: translate(-50%, -50%) rotate(15deg); }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <div class="tricolor-bar"></div>

    <header class="bg-white/95 backdrop-blur-sm shadow-sm sticky top-0 z-50 border-b border-gray-200">
        <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/55/Emblem_of_India.svg" alt="National Emblem of India" class="h-12">
                <div>
                    <h1 class="text-xl font-bold text-gray-800">AVSAR</h1>
                    <p class="text-sm text-gray-500">National Internship Portal</p>
                </div>
            </div>
            <div class="flex items-center space-x-6">
                 <a href="/my-applications" class="text-sm font-semibold text-gray-600 hover:text-blue-600 transition hidden md:block" data-translate="my_applications">My Applications</a>
                 <div class="relative hidden md:block">
                     <select id="language-switcher" class="appearance-none bg-gray-100 border border-gray-200 rounded-md py-2 pl-3 pr-8 text-sm font-medium text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="en">English</option>
                        <option value="hi">हिन्दी</option>
                        <option value="bn">বাংলা</option>
                        <option value="ta">தமிழ்</option>
                        <option value="te">తెలుగు</option>
                    </select>
                 </div>
                 <div class="relative">
                    <button id="profile-dropdown-btn" class="flex items-center space-x-2 focus:outline-none">
                        <div id="header-photo-container" class="h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden">
                             <i class="fas fa-user text-gray-600"></i>
                        </div>
                        <svg class="w-4 h-4 text-gray-600 hidden md:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="profile-dropdown-menu" class="profile-dropdown-menu absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-xl py-2 border z-10">
                        <div class="px-4 py-2 border-b">
                            <p class="text-sm text-gray-500" data-translate="welcome">Welcome,</p>
                            <p class="font-semibold text-gray-800" id="dropdown-username">Applicant Name</p>
                        </div>
                        <a href="/profile" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-translate="view_profile">View Profile</a>
                        <a href="/logout" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100 border-t" data-translate="logout">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow">
        <section class="avsar-banner text-white py-16">
            <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
                <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight" data-translate="portal_title">AVSAR Internship Portal</h1>
                <p class="mt-4 text-lg text-gray-300 max-w-2xl" data-translate="portal_slogan">"Empowering Youth, Powering the Nation."</p>
            </div>
        </section>

        <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
            <section class="mb-12 pt-12">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 card p-6">
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-xl text-gray-800" data-translate="profile_snapshot">Profile Snapshot</h3>
                            <a href="/application-form" class="text-sm font-semibold text-blue-600 hover:underline flex items-center gap-1">
                                <i class="fas fa-edit"></i> <span data-translate="edit_resume">Edit Resume</span>
                            </a>
                        </div>
                        <div class="flex items-center space-x-4 mt-4">
                            <div id="snapshot-photo-container" class="h-20 w-20 rounded-full bg-gray-200 flex items-center justify-center text-3xl text-gray-500 overflow-hidden">
                               <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <span id="snapshot-name" class="font-bold text-xl text-gray-800">Applicant Name</span>
                                <div id="snapshot-skills" class="flex flex-wrap gap-2 mt-2">
                                    <span class="bg-gray-100 text-gray-600 text-xs font-medium px-3 py-1 rounded-full">Loading skills...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card p-6">
                        <h3 class="font-bold text-xl text-gray-800 mb-4" data-translate="action_items">My Action Items</h3>
                        <div class="space-y-4">
                            <div class="flex items-center space-x-3 text-green-700">
                                <i class="fas fa-check-circle fa-fw text-xl"></i>
                                <p class="font-semibold" data-translate="app_submitted">Application Submitted</p>
                            </div>
                            <a href="/my-applications" class="flex items-center space-x-3 text-yellow-700 hover:underline">
                                <i class="fas fa-clock fa-fw text-xl"></i>
                                <p class="font-semibold" data-translate="view_pending">View Pending Applications</p>
                            </a>
                        </div>
                    </div>
                </div>
            </section>
            
            <section class="mb-16">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-8">
                    <h2 class="text-3xl font-bold text-gray-800" data-translate="recommendations_title">Internship Recommendations</h2>
                    <div class="flex items-center gap-2 bg-gray-100 p-1 rounded-lg">
                        <button class="filter-btn text-gray-600 px-4 py-2 rounded-md text-sm font-semibold border-transparent" data-filter="all" data-translate="show_all">Show All</button>
                        <button class="filter-btn active px-4 py-2 rounded-md text-sm font-semibold border-transparent" data-filter="matching" data-translate="top_5">Top 5 For You</button>
                    </div>
                </div>
                <div id="recommendation-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
                <p id="no-results" class="hidden text-center text-gray-600 py-10 bg-gray-50 rounded-lg" data-translate="no_results">No internships found matching your skills. Please update your profile by clicking 'Edit Resume'.</p>
            </section>

             <section>
                <h2 class="text-3xl font-bold text-gray-800 text-center" data-translate="schemes_title">Explore Government Schemes for Youth</h2>
                <p class="text-center text-gray-600 mt-2" data-translate="schemes_slogan">Unlock your potential with these national initiatives.</p>
                <div class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <a href="#" class="card p-6 block">
                        <div class="bg-orange-100 text-orange-500 rounded-lg h-12 w-12 flex items-center justify-center text-2xl mb-4"><i class="fas fa-lightbulb"></i></div>
                        <h3 class="font-bold text-lg">Startup India</h3>
                        <p class="text-sm text-gray-600 mt-1">Fostering a strong ecosystem for innovation and startups.</p>
                    </a>
                    <a href="#" class="card p-6 block">
                        <div class="bg-blue-100 text-blue-500 rounded-lg h-12 w-12 flex items-center justify-center text-2xl mb-4"><i class="fas fa-tools"></i></div>
                        <h3 class="font-bold text-lg">Skill India</h3>
                        <p class="text-sm text-gray-600 mt-1">Empowering the youth with essential skill development.</p>
                    </a>
                    <a href="#" class="card p-6 block">
                        <div class="bg-green-100 text-green-500 rounded-lg h-12 w-12 flex items-center justify-center text-2xl mb-4"><i class="fas fa-industry"></i></div>
                        <h3 class="font-bold text-lg">Make in India</h3>
                        <p class="text-sm text-gray-600 mt-1">Encouraging companies to manufacture their products in India.</p>
                    </a>
                    <a href="#" class="card p-6 block">
                        <div class="bg-red-100 text-red-500 rounded-lg h-12 w-12 flex items-center justify-center text-2xl mb-4"><i class="fas fa-rupee-sign"></i></div>
                        <h3 class="font-bold text-lg">Mudra Yojana</h3>
                        <p class="text-sm text-gray-600 mt-1">Providing loans at low rates to micro-finance institutions.</p>
                    </a>
                </div>
            </section>
        </div>
    </main>

    <footer class="text-center p-6 text-sm text-gray-600 bg-white border-t mt-auto">
        <p>&copy; 2024 Portal is Designed, Developed and Hosted by National Informatics Centre (NIC), Ministry of Electronics and Information Technology, Government of India.</p>
    </footer>
    
    <script>
        const ALL_INTERNSHIPS = [
            { id: 1, title: 'Web Development Intern', org: 'National Informatics Centre (NIC)', stipend: '₹10,000/month', duration: '3 Months', skills: ['HTML', 'CSS', 'JavaScript', 'React'], category: 'Technology' }, { id: 2, title: 'Cyber Security Analyst', org: 'CERT-In', stipend: '₹15,000/month', duration: '6 Months', skills: ['Networking', 'Python', 'Cybersecurity'], category: 'Technology' }, { id: 3, title: 'Data Science Intern', org: 'NITI Aayog', stipend: '₹12,000/month', duration: '4 Months', skills: ['Python', 'R', 'Machine Learning', 'Data Analysis'], category: 'Technology' }, { id: 4, title: 'Software Engineering Intern', org: 'Centre for Development of Advanced Computing (C-DAC)', stipend: '₹18,000/month', duration: '6 Months', skills: ['Java', 'C++', 'Data Structures'], category: 'Technology' }, { id: 5, title: 'UI/UX Design Intern', org: 'MyGov.in', stipend: '₹10,000/month', duration: '3 Months', skills: ['Figma', 'UI/UX', 'Prototyping'], category: 'Technology' }, { id: 6, title: 'Public Policy Research', org: 'PRS Legislative Research', stipend: '₹8,000/month', duration: '2 Months', skills: ['Research', 'Writing', 'Public Policy'], category: 'Research' }, { id: 7, title: 'Economic Research Assistant', org: 'Ministry of Finance', stipend: '₹10,000/month', duration: '3 Months', skills: ['Economics', 'Data Analysis', 'Statistics'], category: 'Research' }, { id: 8, title: 'Legal Research Intern', org: 'Law Commission of India', stipend: '₹5,000/month', duration: '2 Months', skills: ['Legal Research', 'Writing'], category: 'Research' }, { id: 9, title: 'Social Sector Research', org: 'Ministry of Social Justice', stipend: '₹7,500/month', duration: '3 Months', skills: ['Social Work', 'Research', 'MS Office'], category: 'Research' }, { id: 10, title: 'Social Media Management', org: 'Prasar Bharati', stipend: '₹11,000/month', duration: '4 Months', skills: ['Social Media', 'Content Creation', 'Marketing'], category: 'Media' }, { id: 11, title: 'Content Writer (Hindi)', org: 'Ministry of Home Affairs', stipend: '₹9,000/month', duration: '3 Months', skills: ['Hindi Writing', 'Content Creation'], category: 'Media' }, { id: 12, title: 'Graphic Design Intern', org: 'Digital India Corporation', stipend: '₹10,000/month', duration: '3 Months', skills: ['Adobe Photoshop', 'Illustrator', 'Graphic Design'], category: 'Media' }, { id: 13, title: 'Video Production Assistant', org: 'Doordarshan', stipend: '₹12,000/month', duration: '6 Months', skills: ['Video Editing', 'Premiere Pro'], category: 'Media' }, { id: 14, title: 'Civil Engineering Intern', org: 'National Highways Authority of India (NHAI)', stipend: '₹15,000/month', duration: '6 Months', skills: ['AutoCAD', 'Civil Engineering'], category: 'Engineering' }, { id: 15, title: 'Electrical Engineering Intern', org: 'Indian Railways', stipend: '₹14,000/month', duration: '6 Months', skills: ['Electrical Engineering', 'Circuit Design'], category: 'Engineering' }, { id: 16, title: 'Urban Planning Intern', org: 'Ministry of Housing and Urban Affairs', stipend: '₹10,000/month', duration: '4 Months', skills: ['Urban Planning', 'GIS'], category: 'Engineering' }, { id: 17, title: 'Operations Management Intern', org: 'Food Corporation of India (FCI)', stipend: '₹12,000/month', duration: '3 Months', skills: ['Supply Chain', 'Logistics', 'MS Excel'], category: 'Management' }, { id: 18, title: 'HR Intern', org: 'Steel Authority of India (SAIL)', stipend: '₹10,000/month', duration: '2 Months', skills: ['Human Resources', 'MS Office'], category: 'Management' }, { id: 19, title: 'Project Management Assistant', org: 'NITI Aayog', stipend: '₹13,000/month', duration: '6 Months', skills: ['Project Management', 'MS Project'], category: 'Management' }, { id: 20, title: 'Library & Information Science', org: 'National Library of India', stipend: '₹8,000/month', duration: '3 Months', skills: ['Library Science', 'Archiving'], category: 'Other' }, { id: 21, title: 'Statistical Officer Intern', org: 'Ministry of Statistics', stipend: '₹12,000/month', duration: '4 Months', skills: ['Statistics', 'R', 'SPSS'], category: 'Research' }, { id: 22, 'title': 'Content Management Intern', org: 'ePathshala (NCERT)', stipend: '₹9,000/month', duration: '3 Months', skills: ['Content Management', 'MS Office'], category: 'Media' }, { id: 23, title: 'Network Administration Intern', org: 'BSNL', stipend: '₹11,000/month', duration: '6 Months', skills: ['Networking', 'Cisco'], category: 'Technology' }, { id: 24, title: 'Foreign Policy Research', org: 'Ministry of External Affairs', stipend: '₹10,000/month', duration: '3 Months', skills: ['International Relations', 'Research'], category: 'Research' }, { id: 25, title: 'Event Management Intern', org: 'Invest India', stipend: '₹10,000/month', duration: '2 Months', skills: ['Event Management', 'Communication'], category: 'Management' }, { id: 26, title: 'GIS & Remote Sensing', org: 'ISRO', stipend: '₹18,000/month', duration: '6 Months', skills: ['GIS', 'Remote Sensing', 'Python'], category: 'Technology' }, { id: 27, title: 'Public Health Intern', org: 'Ministry of Health', stipend: '₹9,000/month', duration: '3 Months', skills: ['Public Health', 'Research'], category: 'Research' }, { id: 28, title: 'Agricultural Research Intern', org: 'ICAR', stipend: '₹10,000/month', duration: '4 Months', skills: ['Agriculture', 'Biotechnology'], category: 'Research' }, { id: 29, title: 'Digital Marketing Intern', org: 'Startup India Hub', stipend: '₹12,000/month', duration: '3 Months', skills: ['SEO', 'SEM', 'Marketing'], category: 'Media' }, { id: 30, title: 'Financial Analyst Intern', org: 'SEBI', stipend: '₹16,000/month', duration: '6 Months', skills: ['Finance', 'MS Excel', 'Data Analysis'], category: 'Management' }
        ];
        
        let USER_DATA = { name: null, skills: [], photo: null, stream: null, interests: [] };

        const STREAM_TO_CATEGORY_MAP = {
            'Engineering (All Branches)': ['Technology', 'Engineering'], 'Science (Pure & Applied)': ['Technology', 'Research'], 'Commerce & Finance': ['Management', 'Research'], 'Management': ['Management'], 'Arts & Humanities': ['Research', 'Media'], 'Law': ['Research'], 'Medicine': ['Research']
        };

        function displayInternships(internships) {
            const container = document.getElementById('recommendation-cards');
            const noResults = document.getElementById('no-results');
            container.innerHTML = '';
            if (internships.length === 0) {
                noResults.classList.remove('hidden');
                container.classList.add('hidden');
                return;
            }
            noResults.classList.add('hidden');
            container.classList.remove('hidden');
            internships.forEach(internship => {
                let reasonsHTML = '';
                if (internship.reasons && internship.reasons.length > 0) {
                    const reasonsList = internship.reasons.map(reason => `<li class="flex items-center gap-2"><i class="fas fa-check-circle text-green-500"></i>${reason}</li>`).join('');
                    reasonsHTML = `<div class="bg-green-50 border-l-4 border-green-400 text-green-800 p-3 rounded-r-lg mt-4 text-xs">
                        <p class="font-bold mb-1">A top match for you because:</p>
                        <ul class="space-y-1">${reasonsList}</ul>
                    </div>`;
                }

                const cardHTML = `
                <div class="card p-6 flex flex-col">
                    <div>
                        <p class="text-sm font-medium text-gray-500">${internship.org}</p>
                        <h3 class="text-xl font-bold text-gray-800 mt-1">${internship.title}</h3>
                    </div>
                    ${reasonsHTML}
                    <div class="my-5 grid grid-cols-2 gap-4 text-sm text-gray-700 border-t border-b py-4">
                        <div><strong class="text-xs text-gray-500 block">Stipend</strong><p class="font-semibold text-gray-800">${internship.stipend}</p></div>
                        <div><strong class="text-xs text-gray-500 block">Duration</strong><p class="font-semibold text-gray-800">${internship.duration}</p></div>
                    </div>
                    <a href="/internship-details?id=${internship.id}" class="mt-auto inline-block w-full text-center bg-blue-600 text-white font-bold rounded-lg px-4 py-2.5 hover:bg-blue-700 transition-colors duration-200" data-translate="view_apply">View Details & Apply</a>
                </div>`;
                container.innerHTML += cardHTML;
            });
            translatePage(localStorage.getItem('avsarLang') || 'en');
        }

        function getRankedRecommendations() {
            if (!USER_DATA.skills && !USER_DATA.stream && !USER_DATA.interests) return [];
            
            const userSkills = new Set(USER_DATA.skills);
            const userInterests = new Set(USER_DATA.interests);
            const userCategories = STREAM_TO_CATEGORY_MAP[USER_DATA.stream] || [];

            const scoredInternships = ALL_INTERNSHIPS.map(internship => {
                let score = 0;
                let reasons = [];
                const matchingSkills = internship.skills.filter(skill => userSkills.has(skill));

                // 1. Score for Sector Interest (Highest Weight)
                if (userInterests.has(internship.category)) {
                    score += 4;
                    reasons.push(`Matches your interest in <strong>${internship.category}</strong>`);
                }
                
                // 2. Score for Field of Study
                if (userCategories.includes(internship.category)) {
                    score += 3;
                }

                // 3. Score for Skills
                if (matchingSkills.length > 0) {
                    score += matchingSkills.length * 2;
                    reasons.push(`Matches <strong>${matchingSkills.length}</strong> of your skill(s)`);
                }
                
                return { ...internship, score, reasons };
            });

            return scoredInternships.sort((a, b) => b.score - a.score);
        }

        function filterAndDisplayInternships() {
            const activeFilter = document.querySelector(".filter-btn.active").dataset.filter;
            const rankedInternships = getRankedRecommendations();

            if (activeFilter === "matching") {
                const topMatches = rankedInternships.filter(internship => internship.score > 0).slice(0, 5);
                displayInternships(topMatches);
            } else {
                displayInternships(ALL_INTERNSHIPS);
            }
        }

        function populateUserDetails() {
            fetch("/get_user_details")
                .then(res => res.json())
                .then(data => {
                    if (data && data.name) {
                        USER_DATA.name = data.name;
                        USER_DATA.skills = data.skills || [];
                        USER_DATA.photo = data.photo;
                        USER_DATA.stream = data.stream;
                        USER_DATA.interests = data.interests || [];

                        document.getElementById("snapshot-name").textContent = USER_DATA.name;
                        document.getElementById("dropdown-username").textContent = USER_DATA.name;

                        if (USER_DATA.photo) {
                            document.getElementById("snapshot-photo-container").innerHTML = `<img src="${USER_DATA.photo}" class="h-20 w-20 rounded-full object-cover border-4 border-white shadow-md">`;
                            document.getElementById("header-photo-container").innerHTML = `<img src="${USER_DATA.photo}" class="h-10 w-10 rounded-full object-cover">`;
                        }
                        
                        const skillsContainer = document.getElementById("snapshot-skills");
                        skillsContainer.innerHTML = "";
                        if (USER_DATA.skills.length > 0) {
                            USER_DATA.skills.forEach(skill => {
                                const skillPill = document.createElement("span");
                                skillPill.className = "bg-blue-100 text-blue-800 text-xs font-semibold px-3 py-1 rounded-full";
                                skillPill.textContent = skill;
                                skillsContainer.appendChild(skillPill);
                            });
                        } else {
                           skillsContainer.innerHTML = '<span class="bg-gray-100 text-gray-600 text-xs font-medium px-3 py-1 rounded-full">No skills added. Click \'Edit Resume\' to add.</span>';
                        }
                    }
                    filterAndDisplayInternships();
                });
        }
        
        function translatePage(lang) {
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    el.innerText = translations[lang][key];
                }
            });
            localStorage.setItem('avsarLang', lang);
        }

        document.addEventListener("DOMContentLoaded", () => {
            populateUserDetails();
            const profileBtn = document.getElementById("profile-dropdown-btn");
            const profileMenu = document.getElementById("profile-dropdown-menu");
            profileBtn.addEventListener("click", e => { e.stopPropagation(); profileMenu.classList.toggle("active"); });
            window.addEventListener("click", () => { if (profileMenu.classList.contains("active")) profileMenu.classList.remove("active"); });
            const filterButtons = document.querySelectorAll(".filter-btn");
            filterButtons.forEach(button => { button.addEventListener("click", () => { document.querySelector(".filter-btn.active").classList.remove("active"); button.classList.add("active"); filterAndDisplayInternships(); }); });
            const languageSwitcher = document.getElementById('language-switcher');
            languageSwitcher.addEventListener('change', (e) => { translatePage(e.target.value); });
            const savedLang = localStorage.getItem('avsarLang') || 'en';
            languageSwitcher.value = savedLang;
            translatePage(savedLang);
        });
    </script>
</body>
</html>